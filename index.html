<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë…¸ë¸” ì¹´ë“œ ìƒì„±ê¸° V12 (Pro)</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html-to-image/1.11.11/html-to-image.js"></script>
  <style>
    @import url("https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css");

    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 0;
      background-color: #e2e8f0;
      font-family: Pretendard, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      color: #333;
    }

    /* --- ì»¨íŠ¸ë¡¤ íŒ¨ë„ (ìƒë‹¨ ê³ ì •) --- */
    .editor-area {
      width: 100%;
      padding: 15px;
      background: #fff;
      box-shadow: 0 4px 10px rgba(0,0,0,0.05);
      z-index: 100;
      display: flex;
      flex-direction: column;
      gap: 15px;
      position: sticky;
      top: 0;
      max-height: 55vh; /* ì—ë””í„° ì˜ì—­ ì œí•œ */
      overflow-y: auto;
    }

    .main-controls {
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
      border-bottom: 2px solid #f1f5f9;
      padding-bottom: 10px;
    }

    /* --- ìŠ¤íƒ€ì¼ íŒ¨ë„ (ì—…ê·¸ë ˆì´ë“œ) --- */
    .style-panel {
      background: #f8fafc;
      border: 1px solid #e2e8f0;
      padding: 15px;
      border-radius: 12px;
      display: none;
      flex-direction: column;
      gap: 12px;
    }
    .style-panel.open { display: flex; }

    .style-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 13px;
      font-weight: bold;
      color: #475569;
      flex-wrap: wrap;
      gap: 5px;
    }

    /* ìƒ‰ìƒ ì…ë ¥ UI */
    .color-input-group {
      display: flex;
      align-items: center;
      gap: 5px;
      background: #fff;
      border: 1px solid #cbd5e1;
      padding: 4px;
      border-radius: 6px;
    }
    input[type="color"] {
      border: none;
      width: 30px;
      height: 30px;
      cursor: pointer;
      background: none;
    }
    .hex-input {
      border: none;
      font-family: monospace;
      font-size: 12px;
      width: 140px; /* rgba ì…ë ¥ ê³ ë ¤í•˜ì—¬ ë„“ê²Œ */
      outline: none;
      color: #333;
    }

    /* í”„ë¦¬ì…‹ ë²„íŠ¼ë“¤ */
    .preset-container {
      display: flex;
      gap: 5px;
      overflow-x: auto;
      padding-bottom: 5px;
    }
    .btn-preset {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      border: 2px solid #fff;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      cursor: pointer;
      flex-shrink: 0;
    }

    /* ë¸”ë¡ ìŠ¤íƒ€ì¼ */
    .block-item {
      background: #fff;
      border: 1px solid #cbd5e1;
      border-radius: 8px;
      padding: 10px;
      margin-bottom: 10px;
      transition: all 0.2s;
    }
    .block-item.image-block { border-left: 5px solid #f59e0b; }
    .block-item.text-block { border-left: 5px solid #334155; }

    .block-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .block-title {
      font-size: 13px;
      font-weight: bold;
      color: #64748b;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    /* ë²„íŠ¼ë¥˜ */
    .btn-sm {
      padding: 5px 8px;
      font-size: 11px;
      border-radius: 4px;
      border: 1px solid #cbd5e1;
      background: #f8fafc;
      cursor: pointer;
    }
    .btn-edit-toggle { background-color: #334155; color: white; border: none; }
    .btn-split { background-color: #e0f2fe; color: #0369a1; border-color: #bae6fd; font-weight: bold; }
    .btn-merge { background-color: #dcfce7; color: #15803d; border-color: #bbf7d0; font-weight: bold; }
    .btn-strip { background-color: #fff1f2; color: #be123c; border-color: #fda4af; font-weight: bold; }
    .btn-danger { color: #ef4444; border-color: #ef4444; }

    .code-editor {
      width: 100%;
      height: 120px;
      padding: 10px;
      border: 1px solid #334155;
      border-radius: 4px;
      font-family: monospace;
      font-size: 12px;
      resize: vertical;
      background: #f8fafc;
      color: #334155;
      display: none; 
    }
    .code-editor.active { display: block; }

    .block-preview-box {
      padding: 10px;
      background: #f1f5f9;
      border-radius: 4px;
      font-size: 13px;
      color: #475569;
      cursor: pointer;
      min-height: 40px;
      display: none;
    }
    .block-preview-box.active { display: block; }

    /* ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° */
    .editor-img-preview {
      max-width: 80px;
      max-height: 80px;
      border-radius: 4px;
      border: 1px solid #ddd;
    }

    /* ë©”ì¸ ë²„íŠ¼ */
    button { cursor: pointer; border: none; }
    .btn-add-text { background: #334155; color: white; padding: 10px; border-radius: 8px; font-weight: bold; width: 48%; }
    .btn-add-image { background: #f59e0b; color: white; padding: 10px; border-radius: 8px; font-weight: bold; width: 48%; }
    .btn-save { background: #3b82f6; color: white; padding: 12px; border-radius: 8px; font-weight: bold; width: 100%; font-size: 16px; margin-top: 10px;}
    .btn-style { background: #64748b; color: white; padding: 6px 12px; border-radius: 6px; font-size: 13px; font-weight: bold; }

    #imgFileInput { display: none; }

    /* --- ë¯¸ë¦¬ë³´ê¸° ì˜ì—­ --- */
    .preview-container {
      padding: 40px 20px;
      width: 100%;
      overflow-x: auto;
      display: flex;
      justify-content: center;
      background-color: #e2e8f0;
      flex-grow: 1;
      padding-bottom: 150px; /* í•˜ë‹¨ ì—¬ë°± í™•ë³´ */
    }

    #capture-area { background: transparent; transform-origin: top left; }

    /* í†µí•© í”„ë ˆì„ (ë™ì  ìŠ¤íƒ€ì¼ ì ìš©) */
    .card-frame {
      border-radius: 16px; 
      overflow: hidden;
      display: flex;
      flex-direction: column;
      box-shadow: 0 4px 24px rgba(0, 0, 0, 0.20);
    }

    .text-part p { margin: 0 0 1.5em 0; text-align: justify; word-break: keep-all; line-height: 1.8; }
    
    .highlight-span {
      -webkit-box-decoration-break: clone; 
      box-decoration-break: clone; 
      color: #0ea5e9; 
      background: #e0f2fe; 
      padding: 2px 6px; 
      border-radius: 4px;
    }
  </style>
</head>
<body>

  <div class="editor-area">
    <div class="main-controls">
      <div style="display:flex; align-items:center; gap:10px;">
        <span style="font-size: 13px; font-weight: bold;">í­:</span>
        <input type="number" id="cardWidthInput" value="900" step="10" style="width:60px; padding:5px; border:1px solid #ccc; border-radius:4px;"> px
      </div>
      <div style="flex-grow:1"></div>
      <button class="btn-style" onclick="toggleStylePanel()">ğŸ¨ ìŠ¤íƒ€ì¼ ê¾¸ë¯¸ê¸° â–¼</button>
    </div>

    <div id="stylePanel" class="style-panel">
      <div class="style-row" style="justify-content: flex-start; overflow-x: auto;">
        <span>ê°ì„± í”„ë¦¬ì…‹:</span>
        <div class="preset-container" id="presetList">
          </div>
      </div>

      <div class="style-row">
        <span>ê·¸ë¼ë°ì´ì…˜ ë°©í–¥:</span>
        <input type="range" id="gradAngle" min="0" max="360" value="235" oninput="updateCardStyle()">
        <span id="gradAngleVal" style="width:40px; text-align:right;">235Â°</span>
      </div>

      <div class="style-row">
        <span>ë°°ê²½ ì‹œì‘ìƒ‰ (ìœ„):</span>
        <div class="color-input-group">
          <input type="color" id="bgColor1Picker" value="#fbfdff" oninput="syncColorInput('bg1', 'picker')">
          <input type="text" id="bgColor1Text" class="hex-input" value="#fbfdff" oninput="syncColorInput('bg1', 'text')">
        </div>
      </div>

      <div class="style-row">
        <span>ë°°ê²½ ëìƒ‰ (ì•„ë˜):</span>
        <div class="color-input-group">
          <input type="color" id="bgColor2Picker" value="#f1f5f9" oninput="syncColorInput('bg2', 'picker')">
          <input type="text" id="bgColor2Text" class="hex-input" value="#f1f5f9" oninput="syncColorInput('bg2', 'text')">
        </div>
      </div>

      <div class="style-row">
        <span>ê¸€ììƒ‰:</span>
        <div class="color-input-group">
          <input type="color" id="textColorPicker" value="#0f172a" oninput="syncColorInput('text', 'picker')">
          <input type="text" id="textColorText" class="hex-input" value="#0f172a" oninput="syncColorInput('text', 'text')">
        </div>
      </div>

      <div class="style-row">
        <span>ì—¬ë°± (Padding):</span>
        <input type="range" id="paddingRange" min="0" max="100" value="32" oninput="updateCardStyle()">
        <span id="paddingVal" style="width:40px; text-align:right;">32px</span>
      </div>
    </div>

    <div id="block-list"></div>

    <div style="display: flex; justify-content: space-between;">
      <button class="btn-add-text" onclick="addTextBlock()">ğŸ“ ê¸€ ì¶”ê°€</button>
      <button class="btn-add-image" onclick="document.getElementById('imgFileInput').click()">ğŸ–¼ï¸ ì‚¬ì§„ ì¶”ê°€</button>
    </div>

    <button class="btn-save" onclick="saveImage()">ğŸ“¸ ì¹´ë“œ ì €ì¥í•˜ê¸°</button>
    <input type="file" id="imgFileInput" accept="image/*">
  </div>

  <div class="preview-container">
    <div id="capture-area"></div>
  </div>

  <script>
    // --- 1. ìƒíƒœ ë° í”„ë¦¬ì…‹ ë°ì´í„° ---
    const presets = [
      { name: 'ê¸°ë³¸(í™”ì´íŠ¸)', c1: '#fbfdff', c2: '#f1f5f9', t: '#0f172a' },
      { name: 'ìƒˆë²½ë…˜(ë¸”ë£¨)', c1: '#e0f2fe', c2: '#f0f9ff', t: '#0c4a6e' },
      { name: 'í”¼ì¹˜(ì›œí†¤)', c1: '#fff1f2', c2: '#fff7ed', t: '#881337' },
      { name: 'ë¯¸ë“œë‚˜ì‡(ë‹¤í¬)', c1: '#0f172a', c2: '#1e293b', t: '#f8fafc' },
      { name: 'ì˜¤ì…˜(ì²­ëŸ‰)', c1: '#ecfeff', c2: '#cfFAFE', t: '#164e63' },
      { name: 'ì¢…ì´ì§ˆê°', c1: '#fdfbf7', c2: '#f5f5f4', t: '#44403c' }
    ];

    let cardStyle = {
      angle: 235,
      color1: '#fbfdff',
      color2: '#f1f5f9',
      padding: 32,
      textColor: '#0f172a'
    };

    let blocks = [
      {
        type: 'text',
        content: `<p style="font-size:1.2em; font-weight:bold;">ìƒˆë¡œìš´ ìŠ¤íƒ€ì¼ íŒ¨ë„ì„ í™•ì¸í•´ë³´ì„¸ìš”!</p>
<p>ìƒë‹¨ 'ğŸ¨ ìŠ¤íƒ€ì¼ ê¾¸ë¯¸ê¸°'ë¥¼ ëˆ„ë¥´ë©´ ê·¸ë¼ë°ì´ì…˜ ê°ë„, ìƒ‰ìƒ ì½”ë“œ ì…ë ¥, ê°ì„± í”„ë¦¬ì…‹ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>`,
        isEditMode: true // ì²˜ìŒì—” ìˆ˜ì • ëª¨ë“œë¡œ
      }
    ];

    // --- 2. ì´ˆê¸°í™” ---
    window.onload = function() { 
      initPresets();
      renderBlocks(); 
      updatePreview(); 
    }

    // --- 3. ìŠ¤íƒ€ì¼ ê´€ë ¨ ë¡œì§ ---
    function initPresets() {
      const container = document.getElementById('presetList');
      presets.forEach(p => {
        const btn = document.createElement('div');
        btn.className = 'btn-preset';
        btn.style.background = `linear-gradient(135deg, ${p.c1}, ${p.c2})`;
        btn.title = p.name;
        btn.onclick = () => applyPreset(p);
        container.appendChild(btn);
      });
    }

    function applyPreset(p) {
      // ê°’ ì—…ë°ì´íŠ¸
      document.getElementById('bgColor1Picker').value = p.c1;
      document.getElementById('bgColor1Text').value = p.c1;
      document.getElementById('bgColor2Picker').value = p.c2;
      document.getElementById('bgColor2Text').value = p.c2;
      document.getElementById('textColorPicker').value = p.t;
      document.getElementById('textColorText').value = p.t;
      
      // ìŠ¤íƒ€ì¼ ì ìš©
      syncColorInput('bg1', 'text');
      syncColorInput('bg2', 'text');
      syncColorInput('text', 'text');
    }

    // ìƒ‰ìƒ ì¸í’‹ ë™ê¸°í™” (Picker <-> Text)
    function syncColorInput(target, source) {
      let pickerId, textId, value;
      
      if (target === 'bg1') { pickerId = 'bgColor1Picker'; textId = 'bgColor1Text'; }
      else if (target === 'bg2') { pickerId = 'bgColor2Picker'; textId = 'bgColor2Text'; }
      else { pickerId = 'textColorPicker'; textId = 'textColorText'; }

      if (source === 'picker') {
        value = document.getElementById(pickerId).value;
        document.getElementById(textId).value = value;
      } else {
        value = document.getElementById(textId).value;
        // Hex ì½”ë“œì¼ ê²½ìš°ì—ë§Œ í”¼ì»¤ì— ë°˜ì˜ (rgbaëŠ” í”¼ì»¤ê°€ ëª»ë°›ìŒ)
        if(value.startsWith('#') && (value.length === 4 || value.length === 7)) {
          document.getElementById(pickerId).value = value;
        }
      }
      updateCardStyle();
    }

    function updateCardStyle() {
      cardStyle.angle = document.getElementById('gradAngle').value;
      cardStyle.color1 = document.getElementById('bgColor1Text').value;
      cardStyle.color2 = document.getElementById('bgColor2Text').value;
      cardStyle.padding = document.getElementById('paddingRange').value;
      cardStyle.textColor = document.getElementById('textColorText').value;

      document.getElementById('gradAngleVal').innerText = cardStyle.angle + 'Â°';
      document.getElementById('paddingVal').innerText = cardStyle.padding + 'px';
      
      updatePreview();
    }

    function toggleStylePanel() {
      document.getElementById('stylePanel').classList.toggle('open');
    }

    // --- 4. ë¸”ë¡ ë Œë”ë§ (ë²„ê·¸ ìˆ˜ì • í•µì‹¬!) ---
    function renderBlocks() {
      const container = document.getElementById('block-list');
      container.innerHTML = '';

      blocks.forEach((block, index) => {
        const div = document.createElement('div');
        div.className = `block-item ${block.type === 'text' ? 'text-block' : 'image-block'}`;
        
        const canMergeUp = index > 0 && blocks[index-1].type === 'text' && block.type === 'text';

        let innerHTML = `
          <div class="block-header">
            <div class="block-title">
              ${block.type === 'text' ? 'ğŸ“ í…ìŠ¤íŠ¸' : 'ğŸ–¼ï¸ ì´ë¯¸ì§€'} 
              <span style="font-weight:normal; font-size:11px;">#${index + 1}</span>
            </div>
            <div class="block-controls">
              <button class="btn-sm" onclick="moveBlock(${index}, -1)">â¬†ï¸</button>
              <button class="btn-sm" onclick="moveBlock(${index}, 1)">â¬‡ï¸</button>
              <button class="btn-sm btn-danger" onclick="deleteBlock(${index})">ì‚­ì œ</button>
            </div>
          </div>
        `;

        if (block.type === 'text') {
          // â˜… ìˆ˜ì •: onmousedown -> onclickìœ¼ë¡œ ë³€ê²½í•˜ê³  ì´ë²¤íŠ¸ ì²˜ë¦¬ í™•ì‹¤í•˜ê²Œ
          innerHTML += `
            <div style="margin-bottom:5px; display:flex; justify-content:flex-end; gap:5px; flex-wrap:wrap;">
               ${block.isEditMode ? `<button class="btn-sm btn-strip" onclick="stripWrapper(${index})">ğŸ“¦ í¬ì¥ì§€ ì œê±°</button>` : ''}
               ${canMergeUp ? `<button class="btn-sm btn-merge" onclick="mergeUp(${index})">ğŸ§´ í’€ì¹ </button>` : ''}
               ${block.isEditMode ? `<button class="btn-sm btn-split" onclick="splitBlock(event, ${index})">âœ‚ï¸ ìë¥´ê¸°</button>` : ''}
               <button class="btn-sm btn-edit-toggle" onclick="toggleEditMode(${index})">
                 ${block.isEditMode ? 'ğŸ‘ï¸ ë¯¸ë¦¬ë³´ê¸°(ì™„ë£Œ)' : 'âœï¸ ì½”ë“œìˆ˜ì •(í¼ì¹˜ê¸°)'}
               </button>
            </div>

            <div class="block-preview-box ${!block.isEditMode ? 'active' : ''}" onclick="toggleEditMode(${index})">
               ${block.content || '<span style="color:#999">(ë‚´ìš© ì—†ìŒ)</span>'}
            </div>

            <textarea id="editor-${index}" class="code-editor ${block.isEditMode ? 'active' : ''}" 
              oninput="updateText(${index}, this.value)">${block.content}</textarea>
          `;
        } else {
          // ì´ë¯¸ì§€ ë¸”ë¡
          innerHTML += `
            <div style="margin-bottom:5px; display:flex; justify-content:flex-end; gap:5px;">
               <button class="btn-sm btn-edit-toggle" onclick="toggleEditMode(${index})">
                 ${block.isEditMode ? 'ğŸ‘ï¸ ì‚¬ì§„ë§Œ ë³´ê¸°' : 'âš™ï¸ ì„¤ì •'}
               </button>
            </div>
            <div class="${!block.isEditMode ? 'active' : ''}" style="display:${!block.isEditMode ? 'block' : 'none'}; text-align:center;">
               <img src="${block.content}" style="max-width:100%; height:auto; border-radius:8px;">
            </div>
            <div class="${block.isEditMode ? 'active' : ''}" style="display:${block.isEditMode ? 'block' : 'none'};">
              <div style="display:flex; gap:10px; align-items:center; margin-bottom:5px;">
                 <img src="${block.content}" class="editor-img-preview">
                 <div>
                   <span style="font-size:12px;">ë„ˆë¹„: </span>
                   <input type="number" value="${block.width || 100}" 
                     onchange="updateImageWidth(${index}, this.value)" 
                     style="width:50px; text-align:center;"> %
                 </div>
              </div>
              <textarea class="code-editor active" readonly>${block.content.substring(0, 50)}...</textarea>
            </div>
          `;
        }
        div.innerHTML = innerHTML;
        container.appendChild(div);
      });
      
      // ë Œë”ë§ í›„ í…ìŠ¤íŠ¸ ì—ë””í„° ê°’ ê°•ì œ ë™ê¸°í™” (ë²„ê·¸ ë°©ì§€)
      blocks.forEach((block, idx) => {
        if (block.type === 'text') {
           const textarea = document.getElementById(`editor-${idx}`);
           if (textarea) textarea.value = block.content;
        }
      });
    }

    // --- 5. ìµœì¢… ë¯¸ë¦¬ë³´ê¸° ---
    function updatePreview() {
      const cardWidth = document.getElementById('cardWidthInput').value;
      const captureArea = document.getElementById('capture-area');
      
      // ì‚¬ìš©ì ì§€ì • ìŠ¤íƒ€ì¼ ì ìš©
      const frameStyle = `
        width: ${cardWidth}px;
        padding: ${cardStyle.padding}px;
        background: linear-gradient(${cardStyle.angle}deg, ${cardStyle.color1} 0%, ${cardStyle.color2} 100%);
        color: ${cardStyle.textColor};
      `;

      let fullHtml = `<div class="card-frame" style="${frameStyle}">`;

      blocks.forEach(block => {
        if (block.type === 'text') {
          fullHtml += `<div class="text-part">${block.content}</div>`;
        } else {
          fullHtml += `
            <div style="margin: 1.5em 0; text-align: center;">
              <img src="${block.content}" style="width: ${block.width || 100}%; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); display:inline-block;">
            </div>
          `;
        }
      });
      fullHtml += `</div>`;
      captureArea.innerHTML = fullHtml;
    }

    // --- 6. í•µì‹¬ ê¸°ëŠ¥ í•¨ìˆ˜ë“¤ ---

    // í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ (ê°€ì¥ ì¤‘ìš”)
    function updateText(index, val) {
      blocks[index].content = val;
      updatePreview();
    }

    // ìë¥´ê¸° ê¸°ëŠ¥ (ë²„ê·¸ ìˆ˜ì •ë¨)
    function splitBlock(event, index) {
      // ë²„íŠ¼ í´ë¦­ ë“±ìœ¼ë¡œ ì¸í•œ í¬ì»¤ìŠ¤ ì´ë™ ë°©ì§€
      event.preventDefault(); 
      
      const textarea = document.getElementById(`editor-${index}`);
      if (!textarea) return;

      // í˜„ì¬ ì—ë””í„°ì˜ ìµœì‹  ë‚´ìš©ì„ ê°€ì ¸ì˜´ (ì¤‘ìš”)
      const currentContent = textarea.value;
      const cursorPosition = textarea.selectionStart;

      // ìë¥´ê¸° ìˆ˜í–‰
      const firstPart = currentContent.substring(0, cursorPosition);
      const secondPart = currentContent.substring(cursorPosition);

      // ë°ì´í„° ê°±ì‹ 
      blocks[index].content = firstPart;
      blocks[index].isEditMode = true; // ì•ë¶€ë¶„ë„ ìˆ˜ì • ëª¨ë“œ ìœ ì§€

      // ë’·ë¶€ë¶„ ë¸”ë¡ ìƒì„±
      const newBlock = { 
        type: 'text', 
        content: secondPart, 
        isEditMode: true // ìƒˆ ë¸”ë¡ë„ ìˆ˜ì • ëª¨ë“œë¡œ ì‹œì‘
      };

      // ë°°ì—´ ì‚½ì…
      blocks.splice(index + 1, 0, newBlock);

      // ì „ì²´ ë‹¤ì‹œ ê·¸ë¦¬ê¸°
      renderBlocks(); 
      updatePreview();
    }

    function mergeUp(index) {
      if (index <= 0) return;
      if(confirm('ìœ„ìª½ ë‚´ìš©ê³¼ í•©ì¹˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        blocks[index-1].content += blocks[index].content;
        blocks.splice(index, 1);
        renderBlocks(); 
        updatePreview();
      }
    }

    function toggleEditMode(index) {
      blocks[index].isEditMode = !blocks[index].isEditMode;
      renderBlocks();
    }

    function stripWrapper(index) {
      let content = blocks[index].content.trim();
      const wrapperRegex = /^<div[^>]*>([\s\S]*?)<\/div>$/i;
      const match = content.match(wrapperRegex);
      if (match) {
        if(confirm("ê°€ì¥ ë°”ê¹¥ìª½ <div> íƒœê·¸ë¥¼ ì œê±°í• ê¹Œìš”?")) {
          blocks[index].content = match[1].trim();
          renderBlocks();
          updatePreview();
        }
      } else {
        alert("ì œê±°í•  ë°”ê¹¥ìª½ <div>ê°€ ê°ì§€ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
      }
    }

    function addTextBlock() {
      blocks.push({ type: 'text', content: '<p>ìƒˆë¡œìš´ ë¬¸ë‹¨</p>', isEditMode: true });
      renderBlocks(); updatePreview();
    }

    document.getElementById('imgFileInput').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function(event) {
        blocks.push({ type: 'image', content: event.target.result, width: 100, isEditMode: false });
        renderBlocks(); updatePreview(); e.target.value = '';
      };
      reader.readAsDataURL(file);
    });

    function updateImageWidth(index, val) { blocks[index].width = val; updatePreview(); }
    
    function deleteBlock(index) { if (confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) { blocks.splice(index, 1); renderBlocks(); updatePreview(); } }
    
    function moveBlock(index, dir) {
      const newIdx = index + dir;
      if (newIdx < 0 || newIdx >= blocks.length) return;
      [blocks[index], blocks[newIdx]] = [blocks[newIdx], blocks[index]];
      renderBlocks(); updatePreview();
    }

    document.getElementById('cardWidthInput').addEventListener('input', updatePreview);

    function saveImage() {
      const element = document.getElementById("capture-area").firstElementChild;
      const btn = document.querySelector('.btn-save');
      const txt = btn.innerText; 
      btn.innerText = "â³ ê³ í™”ì§ˆ ë³€í™˜ ì¤‘...";
      htmlToImage.toPng(element, { pixelRatio: 2 })
        .then(function (dataUrl) {
          const link = document.createElement('a'); 
          link.download = 'novel_card_' + Date.now() + '.png'; 
          link.href = dataUrl; 
          link.click(); 
          btn.innerText = txt;
        })
        .catch(function (error) { 
          alert("ì €ì¥ ì‹¤íŒ¨ (ë©”ëª¨ë¦¬ ë¶€ì¡± ê°€ëŠ¥ì„±)"); 
          btn.innerText = txt; 
        });
    }
  </script>
</body>
</html>
